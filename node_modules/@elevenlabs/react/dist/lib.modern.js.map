{"version":3,"file":"lib.modern.js","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\nimport {\n  Conversation,\n  Mode,\n  SessionConfig,\n  Callbacks,\n  Options,\n  Status,\n  ClientToolsConfig,\n  InputConfig,\n} from \"@elevenlabs/client\";\n\nexport type {\n  Role,\n  Mode,\n  Status,\n  SessionConfig,\n  DisconnectionDetails,\n  Language,\n} from \"@elevenlabs/client\";\nexport { postOverallFeedback } from \"@elevenlabs/client\";\n\nexport type HookOptions = Partial<\n  SessionConfig & HookCallbacks & ClientToolsConfig & InputConfig\n>;\nexport type ControlledState = {\n  micMuted?: boolean;\n  volume?: number;\n};\nexport type HookCallbacks = Pick<\n  Callbacks,\n  | \"onConnect\"\n  | \"onDisconnect\"\n  | \"onError\"\n  | \"onMessage\"\n  | \"onAudio\"\n  | \"onDebug\"\n  | \"onUnhandledClientToolCall\"\n>;\n\nexport function useConversation<T extends HookOptions & ControlledState>(\n  props: T = {} as T\n) {\n  const { micMuted, volume, ...defaultOptions } = props;\n  const conversationRef = useRef<Conversation | null>(null);\n  const lockRef = useRef<Promise<Conversation> | null>(null);\n  const [status, setStatus] = useState<Status>(\"disconnected\");\n  const [canSendFeedback, setCanSendFeedback] = useState(false);\n  const [mode, setMode] = useState<Mode>(\"listening\");\n\n  useEffect(() => {\n    if (micMuted !== undefined) {\n      conversationRef?.current?.setMicMuted(micMuted);\n    }\n  }, [micMuted]);\n\n  useEffect(() => {\n    if (volume !== undefined) {\n      conversationRef?.current?.setVolume({ volume });\n    }\n  }, [volume]);\n\n  useEffect(() => {\n    return () => {\n      conversationRef.current?.endSession();\n    };\n  }, []);\n\n  return {\n    startSession: (async (options?: HookOptions) => {\n      if (conversationRef.current?.isOpen()) {\n        return conversationRef.current.getId();\n      }\n\n      if (lockRef.current) {\n        const conversation = await lockRef.current;\n        return conversation.getId();\n      }\n\n      try {\n        lockRef.current = Conversation.startSession({\n          ...(defaultOptions ?? {}),\n          ...(options ?? {}),\n          onModeChange: ({ mode }) => {\n            setMode(mode);\n          },\n          onStatusChange: ({ status }) => {\n            setStatus(status);\n          },\n          onCanSendFeedbackChange: ({ canSendFeedback }) => {\n            setCanSendFeedback(canSendFeedback);\n          },\n        } as Options);\n\n        conversationRef.current = await lockRef.current;\n        // Persist controlled state between sessions\n        if (micMuted !== undefined) {\n          conversationRef.current.setMicMuted(micMuted);\n        }\n        if (volume !== undefined) {\n          conversationRef.current.setVolume({ volume });\n        }\n\n        return conversationRef.current.getId();\n      } finally {\n        lockRef.current = null;\n      }\n    }) as T extends SessionConfig\n      ? (options?: HookOptions) => Promise<string>\n      : (options: SessionConfig & HookOptions) => Promise<string>,\n    endSession: async () => {\n      const conversation = conversationRef.current;\n      conversationRef.current = null;\n      await conversation?.endSession();\n    },\n    setVolume: ({ volume }: { volume: number }) => {\n      conversationRef.current?.setVolume({ volume });\n    },\n    getInputByteFrequencyData: () => {\n      return conversationRef.current?.getInputByteFrequencyData();\n    },\n    getOutputByteFrequencyData: () => {\n      return conversationRef.current?.getOutputByteFrequencyData();\n    },\n    getInputVolume: () => {\n      return conversationRef.current?.getInputVolume() ?? 0;\n    },\n    getOutputVolume: () => {\n      return conversationRef.current?.getOutputVolume() ?? 0;\n    },\n    sendFeedback: (like: boolean) => {\n      conversationRef.current?.sendFeedback(like);\n    },\n    getId: () => {\n      return conversationRef.current?.getId();\n    },\n    sendContextualUpdate: (text: string) => {\n      conversationRef.current?.sendContextualUpdate(text);\n    },\n    sendUserMessage: (text: string) => {\n      conversationRef.current?.sendUserMessage(text);\n    },\n    sendUserActivity: () => {\n      conversationRef.current?.sendUserActivity();\n    },\n    sendMCPToolApprovalResult: (toolCallId: string, isApproved: boolean) => {\n      conversationRef.current?.sendMCPToolApprovalResult(\n        toolCallId,\n        isApproved\n      );\n    },\n    status,\n    canSendFeedback,\n    micMuted,\n    isSpeaking: mode === \"speaking\",\n  };\n}\n\n// const con = useConversation({agentId: \"\"})\n"],"names":["_excluded","useConversation","props","micMuted","volume","defaultOptions","_objectWithoutPropertiesLoose","conversationRef","useRef","lockRef","status","setStatus","useState","canSendFeedback","setCanSendFeedback","mode","setMode","useEffect","_conversationRef$curr","undefined","current","setMicMuted","_conversationRef$curr2","setVolume","_conversationRef$curr3","endSession","startSession","async","_conversationRef$curr4","isOpen","getId","Conversation","_extends","options","onModeChange","onStatusChange","onCanSendFeedbackChange","conversation","_conversationRef$curr5","getInputByteFrequencyData","_conversationRef$curr6","getOutputByteFrequencyData","_conversationRef$curr7","getInputVolume","_conversationRef$curr8","_conversationRef$curr9","getOutputVolume","_conversationRef$curr10","_conversationRef$curr11","sendFeedback","like","_conversationRef$curr12","_conversationRef$curr13","sendContextualUpdate","text","_conversationRef$curr14","sendUserMessage","_conversationRef$curr15","sendUserActivity","_conversationRef$curr16","sendMCPToolApprovalResult","toolCallId","isApproved","_conversationRef$curr17","isSpeaking"],"mappings":"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"}